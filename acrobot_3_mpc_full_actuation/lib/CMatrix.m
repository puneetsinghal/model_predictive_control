function CMatrixOut = CMatrix(theta,Dtheta,params)

theta11 = theta(1);
theta12 = theta(2);
theta13 = theta(3);

Dtheta11 = Dtheta(1);
Dtheta12 = Dtheta(2);
Dtheta13 = Dtheta(3);

mBody = params.m3;
mLink = params.m1;
lLink1 = params.l1;
lLink2 = params.l3;
rBody = params.l2;

%%
CMatrixOut = [(1/2).*(Dtheta13.*mBody.*rBody.*(lLink2.*sin(theta13)+lLink1.*sin( ...
  theta12+theta13))+Dtheta12.*lLink1.*(lLink2.*(2.*mBody+mLink).*sin( ...
  theta12)+mBody.*rBody.*sin(theta12+theta13))),(1/2).*(Dtheta13.*lLink2.* ...
  mBody.*rBody.*sin(theta13)+(-1).*Dtheta11.*lLink1.*(lLink2.*(2.*mBody+ ...
  mLink).*sin(theta12)+mBody.*rBody.*sin(theta12+theta13))),(-1/2).* ...
  mBody.*rBody.*(Dtheta12.*lLink2.*sin(theta13)+Dtheta11.*(lLink2.*sin( ...
  theta13)+lLink1.*sin(theta12+theta13)));(1/2).*(Dtheta13.*lLink2.* ...
  mBody.*rBody.*sin(theta13)+(-1).*Dtheta11.*lLink1.*(lLink2.*(2.*mBody+ ...
  mLink).*sin(theta12)+mBody.*rBody.*sin(theta12+theta13))),(1/2).*( ...
  Dtheta13.*lLink2.*mBody.*rBody.*sin(theta13)+(-1).*Dtheta11.*lLink1.*( ...
  lLink2.*(2.*mBody+mLink).*sin(theta12)+mBody.*rBody.*sin(theta12+ ...
  theta13))),(-1/2).*mBody.*rBody.*(Dtheta12.*lLink2.*sin(theta13)+ ...
  Dtheta11.*(lLink2.*sin(theta13)+lLink1.*sin(theta12+theta13)));(-1/2).* ...
  mBody.*rBody.*(Dtheta12.*lLink2.*sin(theta13)+Dtheta11.*(lLink2.*sin( ...
  theta13)+lLink1.*sin(theta12+theta13))),(-1/2).*mBody.*rBody.*( ...
  Dtheta12.*lLink2.*sin(theta13)+Dtheta11.*(lLink2.*sin(theta13)+lLink1.* ...
  sin(theta12+theta13))),(-1/2).*mBody.*rBody.*(Dtheta12.*lLink2.*sin( ...
  theta13)+Dtheta11.*(lLink2.*sin(theta13)+lLink1.*sin(theta12+theta13))) ...
  ];
end